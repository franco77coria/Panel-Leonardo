generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Rubro {
  id         String     @id @default(cuid())
  nombre     String
  createdAt  DateTime   @default(now())
  articulos  Articulo[]
  packs      Pack[]

  @@map("rubros")
}

model Proveedor {
  id        String     @id @default(cuid())
  nombre    String
  telefono  String?
  createdAt DateTime   @default(now())
  articulos Articulo[]

  @@map("proveedores")
}

model Articulo {
  id              String        @id @default(cuid())
  nombre          String
  proveedorId     String?
  rubroId         String?
  costo           Decimal       @default(0) @db.Decimal(12, 2)
  precio          Decimal       @default(0) @db.Decimal(12, 2)
  unidad          String        @default("unidad")
  permiteDecimal  Boolean       @default(false)
  fechaPrecio     DateTime      @default(now())
  activo          Boolean       @default(true)
  createdAt       DateTime      @default(now())
  proveedor       Proveedor?    @relation(fields: [proveedorId], references: [id])
  rubro           Rubro?        @relation(fields: [rubroId], references: [id])
  pedidoItems     PedidoItem[]
  packItems       PackItem[]

  @@map("articulos")
}

model Cliente {
  id            String          @id @default(cuid())
  nombre        String
  direccion     String?
  telefono      String?
  saldo         Decimal         @default(0) @db.Decimal(12, 2)
  activo        Boolean         @default(true)
  createdAt     DateTime        @default(now())
  pedidos       Pedido[]
  movimientosCC MovimientoCC[]

  @@map("clientes")
}

model Pedido {
  id            String        @id @default(cuid())
  numero        Int           @unique @default(autoincrement())
  clienteId     String
  estado        String        @default("pendiente")
  saldoAnterior Decimal       @default(0) @db.Decimal(12, 2)
  total         Decimal       @default(0) @db.Decimal(12, 2)
  notas         String?
  pdfUrl        String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  cerradoAt     DateTime?
  cliente       Cliente       @relation(fields: [clienteId], references: [id])
  items         PedidoItem[]
  movimientosCC MovimientoCC[]

  @@map("pedidos")
}

model PedidoItem {
  id             String   @id @default(cuid())
  pedidoId       String
  articuloId     String
  cantidad       Decimal  @db.Decimal(10, 3)
  precioUnitario Decimal  @db.Decimal(12, 2)
  descuento      Decimal  @default(0) @db.Decimal(5, 2)
  estadoItem     String?
  pedido         Pedido   @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  articulo       Articulo @relation(fields: [articuloId], references: [id])

  @@map("pedido_items")
}

model MovimientoCC {
  id          String   @id @default(cuid())
  clienteId   String
  pedidoId    String?
  tipo        String
  monto       Decimal  @db.Decimal(12, 2)
  descripcion String?
  createdAt   DateTime @default(now())
  cliente     Cliente  @relation(fields: [clienteId], references: [id])
  pedido      Pedido?  @relation(fields: [pedidoId], references: [id])

  @@map("movimientos_cc")
}

model Pack {
  id          String     @id @default(cuid())
  nombre      String
  descripcion String?
  rubroId     String?
  createdAt   DateTime   @default(now())
  rubro       Rubro?     @relation(fields: [rubroId], references: [id])
  items       PackItem[]

  @@map("packs")
}

model PackItem {
  id               String   @id @default(cuid())
  packId           String
  articuloId       String
  cantidadSugerida Decimal  @default(1) @db.Decimal(10, 3)
  pack             Pack     @relation(fields: [packId], references: [id], onDelete: Cascade)
  articulo         Articulo @relation(fields: [articuloId], references: [id])

  @@map("pack_items")
}
